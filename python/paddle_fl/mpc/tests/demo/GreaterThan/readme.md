# 比较（大于）Demo

## 应用场景

两个数据方想要在不暴露自己的原始数据的前提下进行数据的比较。

## 算法原理及整体流程

1. 将双方本地数据按照aby3秘密共享的形式拆分，每方数据分为三份。
2. 将三份数据交给三个不同的计算节点（本demo中的run.sh文件提供了单机模拟三方的示例，实际使用中拆开运行即可）。
3. 双方使用Paddlefl提供的基础运算算子，进行两方联合比较计算。

## 代码执行过程

1. `python3 data.py` 生成双方原始数据，得到Input-P0.list和Input-P1.list。
2. `python3 gt_share.py` 将双方本地数据拆分，得到data_C0_P0.npy、data_C1_P0.npy、data_C2_P0.npy、data_C0_P1.npy、data_C1_P1.npy、data_C2_P1.npy，同时会在命令行打印应当得到的比较计算结果。
3. 在真正的多方运算时需要分发第2步中的秘密数据（本demo不需要这一步）。
4. `python3 flush.py` 清除redis中上一次残留的注册信息，以免下面运行的三方进程连接到错误的地方。
5. `./run.sh` 运行单机模拟三方的脚本执行多方联合计算，logs文件夹中会生成运行日志，同时还会生成结果文件out.txt。

## 其他说明

1. 文件名中C代表计算方的编号，P代表数据方的编号，例如data_C0_P1.npy代表这份秘密来自数据方1，需要交给计算方0。
2. 数据方编号与计算方编号均由0开始。
3. 和paddlefl提供的原始test_op_base.py相比，本demo中注释掉了第70行代码，这一行代码会引起redis注册混乱，从而影响到三方模拟运算；同时将multi_party_run改造成了三个不同的函数，以便三方分别调用单独生成进程。
4. paddlefl提供的比较算子为密文和明文比较，因此在本demo中，需要对双方数据先进行一次减法，再用减法结果和0比较大小。此外，paddlefl比较算子的结果是明文形式，因此也不需要对结果进行重构。
5. 需要预设好双方待比较的数据量大小，该参数为gt_C0.py、gt_C1.py、gt_C2.py中第16行的num。
